<html>
<head>
<title>
Predator/Prey Swarm
</title>
<script type="text/javascript">
canvasWidth = canvasHeight = 500;
numPrey = 10;
numPred = 0;
prey = new Array();
pred = new Array();
interactDist = 30;
flockTogetherScalar = 5;
relativeVelScalar = .7;
spacingScalar = .3;
maxSpeed = .9;

function updatePrey()
{
	// Currently this is naively implemented (or at least it will be)
	// Change later! Currently concern is getting this working.

	// Flock together
	/*
	for (i = 0; i < numPrey; i++)
	{
		var xAdj = 0;
		var yAdj = 0;
		for (j = 0; j < numPrey; j++)
		{
			//if (prey[i].x == prey[j].x || prey[i].y == prey[j].y) 
			//{
			//	continue;
			//}

			xAdj += prey[j].x / numPrey;
			yAdj += prey[j].y / numPrey;
		}

		prey[i].dx = ((xAdj - prey[i].x) * flockTogetherScalar) + (prey[i].dx * (1 - flockTogetherScalar));
		prey[i].dy = ((yAdj - prey[i].y) * flockTogetherScalar) + (prey[i].dy * (1 - flockTogetherScalar));
	}
	//*/

	// Relative velocity
	/*
	for (i = 0; i < numPrey; i++)
	{
		var xAdj = 0;
		var yAdj = 0;
		for (j = 0; j < numPrey; j++)
		{
			xAdj += prey[j].dx / numPrey;
			yAdj += prey[j].dy / numPrey;
		}

		prey[i].dx = (xAdj * relativeVelScalar) + (prey[i].dx * (1 - relativeVelScalar));
		prey[i].dy = (yAdj * relativeVelScalar) + (prey[i].dy * (1 - relativeVelScalar));
	}
	//*/

	// Keep distance
	/*
	for (i = 0; i < numPrey; i++)
	{
		var xAdj = 0.0;
		var yAdj = 0.0;
		for (j = 0; j < numPrey; j++)
		{
		    if (prey[i].x == prey[j].x && prey[i].y == prey[j].y) continue;
			//if (i == j)
				//continue;

			var dist = Math.sqrt(Math.pow(prey[i].x - prey[j].x, 2) + 
					Math.pow(prey[i].y - prey[j].y, 2))

			if (dist > interactDist)
				continue;

			//dist = (dist == 0) ? 1 : dist;

			xAdj -= prey[j].dx / (dist);// * numPrey);
			yAdj -= prey[j].dy / (dist);// * numPrey);
		}
		//prey[i].dx += (xAdj * spacingScalar) + (prey[i].dx * (1 - spacingScalar));
		//prey[i].dy += (yAdj * spacingScalar) + (prey[i].dy * (1 - spacingScalar));
		prey[i].dx += xAdj;
		prey[i].dy += yAdj;
	}
	//*/
	//*
	for (i = 0; i < numPrey; i++)
	{
		var xAdj = 0.0;
		var yAdj = 0.0;
		for (j = 0; j < numPrey; j++)
		{
			if (i == j)
				continue;

			var dist = Math.sqrt(Math.pow(prey[i].x - prey[j].x, 2) +
						Math.pow(prey[i].y - prey[j].y, 2));
			//if (Math.abs(prey[i].x - prey[j].x) < interactDist &&
			//		Math.abs(prey[i].y - prey[j].y) < interactDist)
			if (dist < interactDist)
			{
				//var dist = Math.sqrt(Math.pow(prey[i].x - prey[j].x, 2) +
						//Math.pow(prey[i].y - prey[j].y, 2));
				xAdj += (prey[i].x - prey[j].x) / (dist * numPrey);
				yAdj += (prey[i].y - prey[j].y) / (dist * numPrey);
			}
		}
		prey[i].dx += xAdj * .3;
		prey[i].dy += yAdj * .3;
	}
	//*/



	// Wrap around to other side of screen
	for (i = 0; i < numPrey; i++)
	{
		if (prey[i].x < 0 || prey[i].x > canvasWidth - 1)
		{
			prey[i].x = (prey[i].x > canvasWidth - 1) ? prey[i].x - canvasWidth : prey[i].x + canvasWidth;
		}

		if (prey[i].y < 0 || prey[i].y > 499)
		{
			prey[i].y = (prey[i].y > canvasWidth - 1) ? prey[i].y - canvasWidth : prey[i].y + canvasWidth;
		}
	}

	// Update Prey positions
	for (i = 0; i < numPrey; i++)
	{
		if (prey[i].dx > maxSpeed || prey[i].dx < -maxSpeed)
		{
			var sign = 0;
			sign = (prey[i].dx == 0) ? 0 : ((prey[i].dx < 0) ? -1 : 1);
			prey[i].dx = sign * maxSpeed;
		}

		if (prey[i].dy > maxSpeed || prey[i].dy < -maxSpeed)
		{
			var sign = 0;
			sign = (prey[i].dy == 0) ? 0 : ((prey[i].dy < 0) ? -1 : 1);
			prey[i].dy = sign * maxSpeed;
		}
		//prey[i].x += (prey[i].dx > maxSpeed) ? maxSpeed : prey[i].dx;
		//prey[i].y += (prey[i].dy > maxSpeed) ? maxSpeed : prey[i].dy;
		prey[i].x += prey[i].dx;
		prey[i].y += prey[i].dy;
	} 
}

function updatePred()
{
}

function draw()
{
	updatePrey();
	//updatePred();

	var drawContext = document.getElementById('canvas').getContext('2d');
	drawContext.fillStyle = "rgb(0, 0, 0)";
	drawContext.fillRect(0, 0, canvasWidth, canvasHeight);

	// Draw Prey
	drawContext.fillStyle = "rgb(0, 255, 0)";
	for (i = 0; i < numPrey; i++)
	{
		drawContext.fillRect(prey[i].x, prey[i].y, 5, 5);
	}

	// Draw Predators
	drawContext.fillStyle = "rgb(255, 0, 0)";
	for (i= 0; i < numPred; i++)
	{
		drawContext.fillRect(pred[i].x, pred[i].y, 5, 5);
	}
}

function init() 
{
	for (i = 0; i < numPrey; i++)
	{
		prey[i] = {};
		prey[i].x = Math.floor(Math.random() * canvasWidth) + 0.5;
		prey[i].y = Math.floor(Math.random() * canvasWidth) + 0.5;
		var xDir = Math.floor(Math.random() + .5);
		var yDir = Math.floor(Math.random() + .5);
		xDir = (xDir == 1) ? 1 : -1;
		yDir = (yDir == 1) ? 1 : -1;
		prey[i].dx = xDir * Math.random();
		prey[i].dy = yDir * Math.random();
	}

	for (i = 0; i < numPred; i++)
	{
		pred[i] = {};
		pred[i].x = Math.floor(Math.random() * canvasWidth) + 0.5;
		pred[i].y = Math.floor(Math.random() * canvasWidth) + 0.5;
		pred[i].dx = 0;
		pred[i].dy = 0;
	}
	
	setInterval(draw, 1);
}

</script>
</head>
<body onload="init()">
<canvas id="canvas" width="500" height="500"></canvas>
</body>
</html>
